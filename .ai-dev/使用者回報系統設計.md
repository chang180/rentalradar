# ä½¿ç”¨è€…å›å ±ç³»çµ±è¨­è¨ˆ

## ğŸ¯ ç³»çµ±ç›®æ¨™

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ‘¤ **ä½¿ç”¨è€…è¨»å†Šé©—è­‰**ï¼šçœŸå¯¦ä½¿ç”¨è€…è¨»å†Šå’Œèº«ä»½é©—è­‰
- ğŸ“ **å›å ±è¡¨å–®**ï¼šç°¡æ½”æ˜“ç”¨çš„å›å ±è¡¨å–®
- âš–ï¸ **æ¬Šé‡è¨ˆç®—**ï¼šé©—è­‰ä½¿ç”¨è€…å›å ±æ¬Šé‡æ›´é«˜
- ğŸ† **ä¿¡è­½è©•åˆ†**ï¼šä½¿ç”¨è€…ä¿¡è­½åº¦è©•åˆ†ç³»çµ±
- ğŸ“Š **è³‡æ–™å“è³ª**ï¼šç¢ºä¿å›å ±è³‡æ–™çš„æº–ç¢ºæ€§

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### ä½¿ç”¨è€…è¨»å†Šé©—è­‰æµç¨‹
```php
class UserRegistrationSystem
{
    public function registerUser($userData)
    {
        // 1. åŸºæœ¬è³‡æ–™é©—è­‰
        $validatedData = $this->validateRegistrationData($userData);
        
        // 2. å»ºç«‹ä½¿ç”¨è€…å¸³è™Ÿ
        $user = $this->createUser($validatedData);
        
        // 3. ç™¼é€é©—è­‰éƒµä»¶
        $this->sendVerificationEmail($user);
        
        // 4. ç­‰å¾…ä½¿ç”¨è€…é©—è­‰
        return $user;
    }
    
    public function verifyUser($verificationToken)
    {
        // é©—è­‰ä½¿ç”¨è€…
        $user = $this->findUserByToken($verificationToken);
        if ($user) {
            $user->is_verified = true;
            $user->save();
            return true;
        }
        return false;
    }
}
```

### ä½¿ç”¨è€…æ¬Šé‡è¨ˆç®—ç³»çµ±
```php
class UserWeightCalculator
{
    public function calculateUserWeight($userId)
    {
        $user = User::find($userId);
        
        // åŸºç¤æ¬Šé‡
        $baseWeight = 1.0;
        
        // ä½¿ç”¨è€…ä¿¡è­½åº¦ (0-100)
        $reputationBonus = $user->reputation_score / 100;
        
        // æ­·å²å›å ±æº–ç¢ºåº¦ (0-100)
        $accuracyBonus = $user->historical_accuracy / 100;
        
        // æ´»èºåº¦çå‹µ (æœ€å¤š0.5)
        $activityBonus = min($user->report_count / 10, 0.5);
        
        // é©—è­‰ç‹€æ…‹çå‹µ
        $verificationBonus = $user->is_verified ? 0.2 : 0;
        
        $totalWeight = $baseWeight + $reputationBonus + $accuracyBonus + $activityBonus + $verificationBonus;
        
        return min($totalWeight, 3.0); // æœ€å¤§æ¬Šé‡3å€
    }
    
    public function updateUserReputation($userId, $reportAccuracy)
    {
        $user = User::find($userId);
        
        // æ›´æ–°æ­·å²æº–ç¢ºåº¦
        $newAccuracy = ($user->historical_accuracy * $user->report_count + $reportAccuracy) / ($user->report_count + 1);
        $user->historical_accuracy = $newAccuracy;
        
        // æ›´æ–°ä¿¡è­½è©•åˆ†
        $reputationChange = $this->calculateReputationChange($reportAccuracy);
        $user->reputation_score = max(0, min(100, $user->reputation_score + $reputationChange));
        
        // æ›´æ–°å›å ±æ¬¡æ•¸
        $user->report_count++;
        $user->last_report_at = now();
        
        $user->save();
    }
}
```

### å›å ±è³‡æ–™è™•ç†ç³»çµ±
```php
class UserReportProcessor
{
    public function processReport($reportData, $userId)
    {
        // 1. ä½¿ç”¨è€…èº«ä»½é©—è­‰
        $user = $this->validateUser($userId);
        if (!$user || !$user->is_verified) {
            throw new UnauthorizedException('ä½¿ç”¨è€…æœªé©—è­‰');
        }
        
        // 2. è¡¨å–®é©—è­‰
        $validatedData = $this->validateForm($reportData);
        
        // 3. è³‡æ–™çœŸå¯¦æ€§æª¢æ¸¬
        $authenticityScore = $this->checkAuthenticity($validatedData);
        
        // 4. èˆ‡ç¾æœ‰è³‡æ–™æ¯”å°
        $consistencyScore = $this->checkConsistency($validatedData);
        
        // 5. è¨ˆç®—ä½¿ç”¨è€…æ¬Šé‡
        $userWeight = $this->calculateUserWeight($user);
        
        // 6. è¨ˆç®—æœ€çµ‚ä¿¡å¿ƒåº¦
        $confidenceScore = $this->calculateConfidence($authenticityScore, $consistencyScore, $userWeight);
        
        // 7. å„²å­˜å›å ±è³‡æ–™
        $report = $this->saveReport($validatedData, $userId, $confidenceScore, $userWeight);
        
        return $report;
    }
    
    private function calculateConfidence($authenticityScore, $consistencyScore, $userWeight)
    {
        // åŸºç¤ä¿¡å¿ƒåº¦
        $baseConfidence = ($authenticityScore + $consistencyScore) / 2;
        
        // ä½¿ç”¨è€…æ¬Šé‡åŠ æˆ
        $weightedConfidence = $baseConfidence * $userWeight;
        
        return min(100, $weightedConfidence);
    }
}
```

## ğŸ“Š è³‡æ–™åº«è¨­è¨ˆ

### ä½¿ç”¨è€…è¡¨
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    is_verified BOOLEAN DEFAULT FALSE,
    verification_token VARCHAR(255),
    
    -- ä½¿ç”¨è€…ä¿¡è­½è©•åˆ†
    reputation_score INT DEFAULT 0,      -- ä¿¡è­½è©•åˆ† (0-100)
    historical_accuracy DECIMAL(5,2) DEFAULT 0, -- æ­·å²æº–ç¢ºåº¦ (0-100)
    report_count INT DEFAULT 0,          -- å›å ±æ¬¡æ•¸
    last_report_at TIMESTAMP,           -- æœ€å¾Œå›å ±æ™‚é–“
    
    -- ç³»çµ±æ¬„ä½
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_reputation (reputation_score),
    INDEX idx_verified (is_verified),
    INDEX idx_email (email)
);
```

### ä½¿ç”¨è€…å›å ±è¡¨
```sql
CREATE TABLE user_reports (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    
    -- åŸºæœ¬è³‡è¨Š
    county VARCHAR(10) NOT NULL,
    district VARCHAR(20) NOT NULL,
    address TEXT NOT NULL,
    rent_price DECIMAL(12,2) NOT NULL,
    area DECIMAL(8,2) NOT NULL,
    room_type VARCHAR(20) NOT NULL,
    
    -- æ¬Šé‡è¨ˆç®—
    user_weight DECIMAL(5,2) DEFAULT 1.0, -- ä½¿ç”¨è€…æ¬Šé‡
    confidence_score INT DEFAULT 0,      -- ä¿¡å¿ƒåº¦è©•åˆ†
    authenticity_score INT DEFAULT 0,    -- çœŸå¯¦æ€§è©•åˆ†
    consistency_score INT DEFAULT 0,     -- ä¸€è‡´æ€§è©•åˆ†
    is_verified BOOLEAN DEFAULT FALSE,   -- æ˜¯å¦é©—è­‰é€šé
    
    -- ç³»çµ±æ¬„ä½
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_location (county, district),
    INDEX idx_confidence (confidence_score),
    INDEX idx_created_at (created_at)
);
```

## ğŸ¨ å‰ç«¯ä»‹é¢è¨­è¨ˆ

### ä½¿ç”¨è€…è¨»å†Šé é¢
```jsx
const UserRegistrationForm = () => {
    const [formData, setFormData] = useState({
        name: '',
        email: '',
        password: '',
        confirmPassword: ''
    });
    
    const handleSubmit = async (e) => {
        e.preventDefault();
        
        // è¡¨å–®é©—è­‰
        if (formData.password !== formData.confirmPassword) {
            setError('å¯†ç¢¼ç¢ºèªä¸ç¬¦');
            return;
        }
        
        // æäº¤è¨»å†Š
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            setMessage('è¨»å†ŠæˆåŠŸï¼è«‹æª¢æŸ¥éƒµä»¶é€²è¡Œé©—è­‰');
        }
    };
    
    return (
        <form onSubmit={handleSubmit} className="registration-form">
            <h2>è¨»å†Šå¸³è™Ÿ</h2>
            
            <div className="form-group">
                <label>å§“å</label>
                <input 
                    type="text" 
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>é›»å­éƒµä»¶</label>
                <input 
                    type="email" 
                    value={formData.email}
                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>å¯†ç¢¼</label>
                <input 
                    type="password" 
                    value={formData.password}
                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>ç¢ºèªå¯†ç¢¼</label>
                <input 
                    type="password" 
                    value={formData.confirmPassword}
                    onChange={(e) => setFormData({...formData, confirmPassword: e.target.value})}
                    required
                />
            </div>
            
            <button type="submit" className="btn-primary">
                è¨»å†Š
            </button>
        </form>
    );
};
```

### å›å ±è¡¨å–®é é¢
```jsx
const ReportForm = () => {
    const [formData, setFormData] = useState({
        county: '',
        district: '',
        address: '',
        rent_price: '',
        area: '',
        room_type: ''
    });
    
    const handleSubmit = async (e) => {
        e.preventDefault();
        
        // æäº¤å›å ±
        const response = await fetch('/api/reports', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${userToken}`
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            setMessage('å›å ±æˆåŠŸï¼æ„Ÿè¬æ‚¨çš„è²¢ç»');
        }
    };
    
    return (
        <form onSubmit={handleSubmit} className="report-form">
            <h2>å›å ±ç§Ÿé‡‘è³‡è¨Š</h2>
            
            <div className="form-group">
                <label>ç¸£å¸‚</label>
                <select 
                    value={formData.county}
                    onChange={(e) => setFormData({...formData, county: e.target.value})}
                    required
                >
                    <option value="">è«‹é¸æ“‡ç¸£å¸‚</option>
                    <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                    <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                    {/* å…¶ä»–ç¸£å¸‚ */}
                </select>
            </div>
            
            <div className="form-group">
                <label>è¡Œæ”¿å€</label>
                <input 
                    type="text" 
                    value={formData.district}
                    onChange={(e) => setFormData({...formData, district: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>åœ°å€</label>
                <input 
                    type="text" 
                    value={formData.address}
                    onChange={(e) => setFormData({...formData, address: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>ç§Ÿé‡‘ (å…ƒ/æœˆ)</label>
                <input 
                    type="number" 
                    value={formData.rent_price}
                    onChange={(e) => setFormData({...formData, rent_price: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>åªæ•¸</label>
                <input 
                    type="number" 
                    value={formData.area}
                    onChange={(e) => setFormData({...formData, area: e.target.value})}
                    required
                />
            </div>
            
            <div className="form-group">
                <label>æˆ¿å‹</label>
                <select 
                    value={formData.room_type}
                    onChange={(e) => setFormData({...formData, room_type: e.target.value})}
                    required
                >
                    <option value="">è«‹é¸æ“‡æˆ¿å‹</option>
                    <option value="å¥—æˆ¿">å¥—æˆ¿</option>
                    <option value="é›…æˆ¿">é›…æˆ¿</option>
                    <option value="æ•´å±¤">æ•´å±¤</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            
            <button type="submit" className="btn-primary">
                æäº¤å›å ±
            </button>
        </form>
    );
};
```

## ğŸš€ å¯¦ä½œæ™‚ç¨‹

### Phase 5: ä½¿ç”¨è€…å›å ±ç³»çµ± (1é€±)
- [ ] **Day 1-2**: é–‹ç™¼ä½¿ç”¨è€…è¨»å†Šé©—è­‰ç³»çµ±
- [ ] **Day 3-4**: å¯¦ä½œæ¬Šé‡è¨ˆç®—æ©Ÿåˆ¶
- [ ] **Day 5-6**: å»ºç«‹ä½¿ç”¨è€…ä¿¡è­½è©•åˆ†
- [ ] **Day 7**: æ•´åˆæ¸¬è©¦å’Œå„ªåŒ–

### æŠ€è¡“é©—è­‰é‡é»
- [ ] **ä½¿ç”¨è€…é©—è­‰**ï¼šè¨»å†Šå’Œé©—è­‰æµç¨‹çš„ç©©å®šæ€§
- [ ] **æ¬Šé‡è¨ˆç®—**ï¼šä½¿ç”¨è€…æ¬Šé‡è¨ˆç®—çš„æº–ç¢ºæ€§
- [ ] **ä¿¡è­½è©•åˆ†**ï¼šä¿¡è­½åº¦è©•åˆ†ç³»çµ±çš„æ•ˆæœ
- [ ] **è³‡æ–™å“è³ª**ï¼šå›å ±è³‡æ–™çš„å“è³ªæ§åˆ¶

---

**ğŸ¯ ç³»çµ±åƒ¹å€¼ï¼š**
- ç¢ºä¿å›å ±è³‡æ–™çš„çœŸå¯¦æ€§å’Œæº–ç¢ºæ€§
- å»ºç«‹ä½¿ç”¨è€…ä¿¡è­½è©•åˆ†æ©Ÿåˆ¶
- æå‡è³‡æ–™å“è³ªå’Œå¯ä¿¡åº¦
- ç‚ºæ”¿åºœå¹³å°æ´»åŒ–æ‡‰ç”¨å¢åŠ ä½¿ç”¨è€…åƒèˆ‡åŠŸèƒ½
